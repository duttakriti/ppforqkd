#ifndef PPA_Error_Correction_h
#define PPA_Error_Correction_h

#include "Arduino.h"

class PPA_Error_Correction{

    public:

    PPA_Error_Correction();
    void startErrorCorrection();
    bool proceedErrorCorrection();
    void prepare_Data();
    void calc_permutations();
    void sendPairities();
    void prepare_blocks();
    void shuffle_array(int *array,int seed);

    private:

    int read_int();
    void printIntArray(int b[], int len);

    const static int BLOCK_SIZE = 512;
    const byte bitString[256] = {'0', '1', '1', '0', '0', '0', '1', '0', '1', '1', '1', '1', '0', '1', '0', '1', '1', '0', '0', '0', '0', '0', '1', '1', '1', '0', '0', '0', '1', '1', '1', '0', '0', '0', '1', '0', '0', '0', '1', '0', '0', '0', '0', '0', '1', '1', '0', '1', '0', '0', '1', '0', '1', '0', '0', '1', '1', '0', '0', '0', '0', '0', '0', '1', '0', '0', '1', '0', '1', '0', '1', '1', '1', '1', '1', '0', '0', '0', '0', '0', '0', '1', '1', '0', '0', '1', '1', '1', '1', '0', '0', '0', '1', '0', '1', '1', '0', '1', '1', '0', '0', '0', '1', '0', '1', '0', '1', '1', '1', '0', '0', '1', '1', '0', '0', '1', '1', '0', '1', '1', '0', '1', '1', '1', '0', '1', '1', '0', '1', '0', '1', '1', '1', '1', '1', '0', '0', '1', '1', '0', '1', '1', '0', '0', '1', '0', '0', '0', '0', '1', '0', '1', '0', '1', '0', '0', '1', '1', '1', '0', '0', '1', '1', '1', '0', '0', '1', '1', '0', '0', '1', '0', '0', '1', '1', '1', '1', '0', '1', '0', '1', '0', '1', '1', '1', '1', '1', '0', '1', '0', '0', '0', '1', '0', '0', '1', '1', '1', '0', '0', '0', '0', '1', '0', '0', '0', '1', '0', '1', '0', '0', '0', '0', '0', '0', '0', '0', '1', '0', '1', '0', '1', '0', '0', '0', '1', '0', '0', '0', '1', '0', '0', '1', '1', '1', '0', '1', '0', '1', '1', '1', '0', '0', '1', '1', '0', '1', '0', '0', '0', '1', '1', '1', '0', '1', '1'};

    /*const int block0[BLOCK_SIZE] = {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255};
    const int block1[BLOCK_SIZE] = {255,89,2,191,68,179,224,50,171,148,125,134,63,206,211,159,141,188,123,1,230,11,70,67,231,169,52,235,181,82,116,120,138,22,168,234,200,166,156,202,170,186,53,165,180,14,217,86,209,85,226,240,155,101,35,204,6,47,109,132,9,27,21,241,5,251,198,8,20,205,227,72,172,4,102,154,57,160,118,16,69,130,218,212,0,193,157,139,30,58,110,245,228,24,243,183,33,7,162,124,236,187,94,238,177,249,129,244,232,196,108,210,229,164,91,173,90,46,26,23,174,55,145,142,81,242,66,184,250,28,219,127,213,189,92,167,121,146,246,119,176,80,45,49,135,56,203,163,199,254,104,64,252,195,192,71,38,78,73,51,112,44,115,60,25,59,133,182,216,42,62,18,3,247,220,151,237,41,88,122,225,149,103,31,29,48,113,65,105,207,161,83,17,32,76,153,106,10,215,95,36,222,178,152,40,13,79,39,12,144,197,131,19,114,98,158,233,97,99,214,128,239,84,96,194,248,117,37,43,93,221,136,15,185,54,75,74,87,190,223,100,137,107,201,143,34,111,61,175,126,77,253,147,208,140,150};
    const int block2[BLOCK_SIZE] = {189,34,101,103,187,20,119,22,45,126,147,224,0,58,227,188,93,159,170,243,118,229,10,11,241,236,96,201,242,175,244,85,142,217,64,186,253,196,83,198,40,134,42,63,57,18,143,44,235,4,3,88,199,75,21,197,113,50,240,174,35,231,148,100,36,84,12,204,132,245,71,30,110,32,37,169,60,56,237,65,6,164,62,26,111,250,86,140,116,183,108,106,216,138,15,225,33,238,211,127,153,209,109,144,38,213,102,79,39,205,7,233,208,230,105,173,87,82,5,51,161,97,172,151,165,8,156,251,55,212,234,158,59,13,122,179,219,135,182,91,157,210,133,41,94,23,117,25,47,125,193,1,226,61,49,247,24,255,252,16,28,180,167,81,99,177,152,149,228,78,31,92,67,129,54,112,160,46,9,203,202,146,89,223,200,14,114,128,171,185,77,214,248,249,52,207,239,136,221,68,166,90,178,104,98,246,43,70,27,73,218,194,141,181,232,29,53,17,184,74,72,130,139,215,66,123,76,155,115,222,154,220,121,120,145,162,69,192,80,19,124,2,195,163,191,168,137,107,95,206,190,176,150,48,254,131};
    const int block3[BLOCK_SIZE] = {53,210,237,217,94,230,174,54,125,102,87,123,128,17,28,116,122,25,11,67,55,117,89,39,88,37,156,196,199,182,112,132,166,171,93,83,51,227,108,225,245,65,252,96,86,64,197,228,46,91,18,176,177,71,14,8,105,135,188,23,21,254,169,251,124,239,187,119,6,206,20,158,27,90,57,191,40,221,4,12,106,77,203,172,48,29,81,76,141,58,136,63,224,47,114,41,181,140,244,215,180,62,164,168,45,50,10,42,73,59,202,111,78,186,104,13,229,43,56,153,84,19,148,60,24,146,220,44,30,208,70,213,35,7,173,52,109,9,118,115,72,139,152,142,3,150,154,126,190,240,248,241,226,121,151,255,178,34,201,163,1,127,216,207,98,175,160,66,134,236,222,16,133,218,130,100,162,211,32,231,185,31,253,159,79,212,97,99,195,69,179,233,155,2,223,5,137,243,101,165,107,250,219,22,214,138,36,131,68,103,143,74,232,95,61,247,147,49,15,92,85,238,193,209,235,184,33,0,249,167,183,149,189,242,38,145,157,234,170,198,110,82,194,129,204,120,80,200,205,26,144,75,161,246,192,113};
    */

    
    int block0[BLOCK_SIZE]; 
    int block1[BLOCK_SIZE];
    int block2[BLOCK_SIZE];
    int block3[BLOCK_SIZE];

    byte mykey[32];

    boolean pair_alice0[16]; 
    boolean pair_alice1[8]; 
    boolean pair_alice2[4]; 
    boolean pair_alice3[2]; 

    int block_sizes[4];
};

#endif